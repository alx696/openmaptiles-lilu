# 生成中国区域离线数据

准备OSM数据:

```shell
make start-db && \
make import-data && \
make download-osmfr area=asia/china && \
make import-osm area=asia/china && \
make import-wikidata
```

在 geo-tool 项目中执行 `sh tif-to-pg.sh -D="/home/l/hd/数据/GDEM-中国/tif-3857" -I=500` 导入等高线数据, 然后生成离线数据:

```shell
make import-sql && \
make generate-tiles-pg
```

---

# 补充

## 下载指定区域OSM数据

查看可用区域:

```shell
make list-geofabrik | more
```

> 按 Enter 键下一页, 按 q 键退出.

下载区域数据:

```shell
make download-osmfr area=asia/china/sichuan
```

## 导入Wikidata数据时使用代理

天朝需要科学上网, 修改 `.env` 和 `Makefile` 中的 WIKIDATA_PROXY !

## 定义 style.json 注意

`source-layer` 相同时, 必须使用 `filter` 进行区分才能定义不同的样式! 例如 `transportation_name` 中的 `style.json` , 如果不过滤则只有首先被应用的样式才会生效!

## 等高线

使用 geo-tool 导入等高线数据.

---

# 调试

## 重建数据库

```shell
make destroy-db && \
make start-db && \
make import-data
```

## 单独修改mapping.yaml

```shell
make clean && make && \
make import-osm area=asia/china/sichuan && make import-wikidata
```

## 单独修改sql

```shell
make clean && make && \
make import-sql && \
make stop-postserve && make start-postserve
```

## 单独修改style.json

```shell
make clean && make && make build-style
```

## 在线调试

```shell
make stop-maputnik && \
make start-maputnik
```

## 调试离线数据

```shell
make stop-tileserver && \
make generate-tiles-pg && \
make start-tileserver
```

---
